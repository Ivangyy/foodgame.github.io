function init(e){var i=generateData(e);$.fn.dataTable.ext.search.push(function(e,i,c){return!!($("#chk-skill-stirfry").prop("checked")&&(parseInt(i[3])||0)>0||$("#chk-skill-boil").prop("checked")&&(parseInt(i[4])||0)>0||$("#chk-skill-cut").prop("checked")&&(parseInt(i[5])||0)>0||$("#chk-skill-fry").prop("checked")&&(parseInt(i[6])||0)>0||$("#chk-skill-roast").prop("checked")&&(parseInt(i[7])||0)>0||$("#chk-skill-steam").prop("checked")&&(parseInt(i[8])||0)>0)}),$.fn.dataTable.ext.search.push(function(e,i,c){var s=$("#chk-guest").prop("checked"),r=i[17];return!!(!s||s&&r)}),$.fn.dataTable.ext.search.push(function(e,i,c){var s=$("#chk-fire-1").prop("checked"),r=$("#chk-fire-2").prop("checked"),t=$("#chk-fire-3").prop("checked"),p=$("#chk-fire-4").prop("checked"),n=$("#chk-fire-5").prop("checked"),h=parseInt(i[2])||0;return!!(s&&1==h||r&&2==h||t&&3==h||p&&4==h||n&&5==h)});for(j in e.chefs)$("#chk-show-chef").append("<option value='"+j+"'>"+e.chefs[j].name+"</option>"),$("#food-table thead tr").append("<th>"+e.chefs[j].name+"</th>").append("<th>金币/小时</th>");var c=$("#food-table").DataTable({data:i,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 条",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 条记录",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 条记录中过滤)"},pagingType:"numbers",lengthMenu:[[20,50,100,-1],[20,50,100,"所有"]],pageLength:20});$('.chk-skill input[type="checkbox"]').click(function(){$(this).prop("checked")?($(".multi-switch").hasClass("active")||$(".chk-skill input[type='checkbox']").prop("checked",!1),$(this).prop("checked",!0)):$(this).prop("checked",!1),c.draw()}),$('.chk-fire input[type="checkbox"]').click(function(){$(this).prop("checked")?$(this).prop("checked",!0):$(this).prop("checked",!1),c.draw()}),$('.chk-guest input[type="checkbox"]').click(function(){$(this).prop("checked")?$(this).prop("checked",!0):$(this).prop("checked",!1),c.draw()}),$(".multi-switch").click(function(){$(this).hasClass("active")?($(".chk-skill input[type=checkbox]:checked").length>1&&($(".chk-skill input[type='checkbox']").prop("checked",!1),c.draw()),$(".chk-skill-all").addClass("disabled")):$(".chk-skill-all").removeClass("disabled")}),$(".chk-skill-all").click(function(){$(".multi-switch").hasClass("active")&&($(".chk-skill input[type='checkbox']").prop("checked",!0),c.draw())}),$(".function-switch").click(function(){if($(".function-switch").hasClass("active")){$("#chk-show-quality").prop("checked",!0).parent(".btn").removeClass("hidden"),$("#chk-show-remark").prop("checked",!0).parent(".btn").removeClass("hidden");for(j in e.chefs)e.chefs[j].show&&$("#chk-show-chef").multiselect("select",j);$("#chk-show-chef").parent(".chk-show-chef-wrapper").removeClass("hidden")}else $("#chk-show-quality").prop("checked",!1).parent(".btn").addClass("hidden"),$("#chk-show-remark").prop("checked",!1).parent(".btn").addClass("hidden"),$("#chk-show-chef").multiselect("deselectAll",!1).parent(".chk-show-chef-wrapper").addClass("hidden");initShow(c,e)}),initShow(c,e),$('.chk-show input[type="checkbox"]').click(function(){initShow(c,e)}),$("#chk-show-chef").multiselect({enableFiltering:!0,filterPlaceholder:"查找",includeSelectAllOption:!0,numberDisplayed:1,selectAllText:"选择所有",allSelectedText:"厨师",nonSelectedText:"厨师",nSelectedText:"厨师",onChange:function(i,s,r){initShow(c,e)}})}function generateData(e){var c=new Array;for(i in e.recipes)if(e.recipes[i].name){e.recipes[i].price>0&&e.recipes[i].time>0&&(e.recipes[i].efficiency=3600*e.recipes[i].price/e.recipes[i].time,e.recipes[i].total>0&&(e.recipes[i].totalPrice=e.recipes[i].price*e.recipes[i].total,e.recipes[i].totalTime=e.recipes[i].time*e.recipes[i].total)),e.recipes[i].ingredients="";for(k in e.recipes[i].ingredient)e.recipes[i].ingredients+=e.ingredients[e.recipes[i].ingredient[k].ingredientId].name+"*"+e.recipes[i].ingredient[k].quantity+" ";e.recipes[i].guests="";for(m in e.guests){var s=!1;for(n in e.guests[m].recipes)if(e.recipes[i].recipeId==e.guests[m].recipes[n].recipeId){s=!0;break}if(s){e.recipes[i].guests+=e.guests[m].name+" - ";for(n in e.guests[m].recipes){var r=!1;if(e.guests[m].recipes[n].recipeId>0)for(o in e.recipes)if(e.recipes[o].recipeId==e.guests[m].recipes[n].recipeId){e.recipes[i].guests+=e.recipes[o].name+" ",r=!0;break}r||(e.recipes[i].guests+=" 暂无 ")}e.recipes[i].guests+=" - ";for(n in e.guests[m].runes)e.recipes[i].guests+=e.runes[e.guests[m].runes[n].runeId].name+" ";e.recipes[i].guests+="<br>"}}if(0==e.recipes[i].unlock)e.recipes[i].unlockname="有";else if(e.recipes[i].unlock>0)for(m in e.recipes)if(e.recipes[m].recipeId==e.recipes[i].unlock){e.recipes[i].unlockname=e.recipes[m].name;break}c.push([e.recipes[i].recipeId,e.recipes[i].name,e.recipes[i].fire||"",e.recipes[i].stirfry||"",e.recipes[i].boil||"",e.recipes[i].cut||"",e.recipes[i].fry||"",e.recipes[i].roast||"",e.recipes[i].steam||"",e.recipes[i].ingredients||"",e.recipes[i].price||"",e.recipes[i].time||"",e.recipes[i].total||"",e.recipes[i].hasOwnProperty("totalPrice")?e.recipes[i].totalPrice:"",e.recipes[i].hasOwnProperty("totalTime")?e.recipes[i].totalTime:"",e.recipes[i].hasOwnProperty("efficiency")?parseInt(e.recipes[i].efficiency):"",e.recipes[i].unlockname||"-",e.recipes[i].hasOwnProperty("guests")?e.recipes[i].guests:"",e.recipes[i].quality,e.recipes[i].remark]);for(j in e.chefs){var t=Number.MAX_VALUE;e.recipes[i].stirfry>0&&(t=e.chefs[j].stirfry>0?Math.min(t,e.chefs[j].stirfry/e.recipes[i].stirfry):0),t>=1&&e.recipes[i].boil>0&&(t=e.chefs[j].boil>0?Math.min(t,e.chefs[j].boil/e.recipes[i].boil):0),t>=1&&e.recipes[i].cut>0&&(t=e.chefs[j].cut>0?Math.min(t,e.chefs[j].cut/e.recipes[i].cut):0),t>=1&&e.recipes[i].fry>0&&(t=e.chefs[j].fry>0?Math.min(t,e.chefs[j].fry/e.recipes[i].fry):0),t>=1&&e.recipes[i].roast>0&&(t=e.chefs[j].roast>0?Math.min(t,e.chefs[j].roast/e.recipes[i].roast):0),t>=1&&e.recipes[i].steam>0&&(t=e.chefs[j].steam>0?Math.min(t,e.chefs[j].steam/e.recipes[i].steam):0);var p="-",h="";if(t!=Number.MAX_VALUE&&t>=1){var l=0;t>=4?(l=.5,p="神"):t>=3?(l=.3,p="特"):t>=2?(l=.1,p="优"):t>=1&&(l=0,p="可");var a=0;if(e.chefs[j].hasOwnProperty("skill"))for(k in e.chefs[j].skill)if("水产"==e.chefs[j].skill[k].type){var f=!1;for(k in e.recipes[i].ingredient)if(8==e.ingredients[e.recipes[i].ingredient[k].ingredientId].originId){f=!0;break}f&&(a+=e.chefs[j].skill[k].addition)}else if("炸类"==e.chefs[j].skill[k].type){var f=!1;for(k in e.recipes[i].ingredient)if(e.recipes[i].fry>0){f=!0;break}f&&(a+=e.chefs[j].skill[k].addition)}var d=0;e.hasOwnProperty("furniture")&&(d=e.furniture),e.recipes[i].hasOwnProperty("efficiency")&&(h=(1+l+a+d)*e.recipes[i].efficiency)}c[i].push(p),c[i].push(parseInt(h)||"")}}return c}function initShow(e,i){e.column(0).visible($("#chk-show-id").prop("checked"),!1),e.column(2).visible($("#chk-show-fire").prop("checked"),!1);var c=$("#chk-show-skill").prop("checked");e.column(3).visible(c,!1),e.column(4).visible(c,!1),e.column(5).visible(c,!1),e.column(6).visible(c,!1),e.column(7).visible(c,!1),e.column(8).visible(c,!1),e.column(9).visible($("#chk-show-ingredient").prop("checked"),!1);var s=$("#chk-show-price").prop("checked");e.column(10).visible(s,!1),e.column(11).visible(s,!1);var r=$("#chk-show-total-price").prop("checked");e.column(12).visible(r,!1),e.column(13).visible(r,!1),e.column(14).visible(r,!1),e.column(15).visible($("#chk-show-efficiency").prop("checked"),!1),e.column(16).visible($("#chk-show-unlock").prop("checked"),!1),e.column(17).visible($("#chk-show-guest").prop("checked"),!1),e.column(18).visible($("#chk-show-quality").prop("checked"),!1),e.column(19).visible($("#chk-show-remark").prop("checked"),!1);for(j in i.chefs){var t=$("#chk-show-chef").val();e.column(20+2*j).visible(t.indexOf(j)>-1,!1),e.column(21+2*j).visible(t.indexOf(j)>-1,!1)}e.columns.adjust().draw(!1)}$(function(){$.ajax({cache:!1,success:function(e){init(e)},url:"data/data.json"})});