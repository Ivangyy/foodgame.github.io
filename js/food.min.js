function init(e){var i=window.location.search.indexOf("666")>0,r=generateData(e,i),c=[{data:"recipeId"},{data:"name"},{data:{_:"fire.value",display:"fire.display"}},{data:"stirfry"},{data:"boil"},{data:"cut"},{data:"fry"},{data:"roast"},{data:"steam"},{data:{_:"ingredients.value",display:"ingredients.display"}},{data:"price"},{data:{_:"time.value",display:"time.display"}},{data:"total"},{data:"totalPrice"},{data:{_:"totalTime.value",display:"totalTime.display"}},{data:"efficiency"},{data:"ingredientsEff"},{data:"origin"},{data:"unlock"},{data:"guests"},{data:{_:"levelGuests.value",display:"levelGuests.display"}},{data:"godRune"},{data:"get"},{data:"quality"},{data:"remark"}];for(j in r.chefs)$("#chk-show-chef").append("<option value='"+j+"'>"+r.chefs[j].name+"</option>"),$("#food-table thead tr").append("<th>"+r.chefs[j].name+"</th>").append("<th>效率</th>"),c.push({data:"chefs."+j+".chefQlty",searchable:!1}),c.push({data:"chefs."+j+".chefEff",searchable:!1});var s=$("#food-table").DataTable({data:r.recipes,columns:c,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个菜谱中过滤)"},pagingType:"numbers",lengthMenu:[[20,50,100,-1],[20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",fixedHeader:!0});if(s.fixedHeader.disable(),$("div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="菜名 材料 贵客 符文"></label>'),$.fn.dataTable.ext.search.push(function(e,i,r){var c=$("#chk-fire-0").prop("checked"),s=$("#chk-fire-1").prop("checked"),n=$("#chk-fire-2").prop("checked"),t=$("#chk-fire-3").prop("checked"),a=$("#chk-fire-4").prop("checked"),o=$("#chk-fire-5").prop("checked"),l=parseInt(i[2])||0;return!!(c&&0==l||s&&1==l||n&&2==l||t&&3==l||a&&4==l||o&&5==l)}),$.fn.dataTable.ext.search.push(function(e,i,r){return!!($("#chk-skill-stirfry").prop("checked")&&(parseInt(i[3])||0)>0||$("#chk-skill-boil").prop("checked")&&(parseInt(i[4])||0)>0||$("#chk-skill-cut").prop("checked")&&(parseInt(i[5])||0)>0||$("#chk-skill-fry").prop("checked")&&(parseInt(i[6])||0)>0||$("#chk-skill-roast").prop("checked")&&(parseInt(i[7])||0)>0||$("#chk-skill-steam").prop("checked")&&(parseInt(i[8])||0)>0||$("#chk-skill-unknown").prop("checked")&&0==(parseInt(i[3])||0)&&0==(parseInt(i[4])||0)&&0==(parseInt(i[5])||0)&&0==(parseInt(i[6])||0)&&0==(parseInt(i[7])||0)&&0==(parseInt(i[8])||0))}),$.fn.dataTable.ext.search.push(function(e,i,r){var c=parseInt($("#input-price").val()),s=parseFloat(i[10])||0;return!!(isNaN(c)||c<s)}),$.fn.dataTable.ext.search.push(function(e,i,r){var c=$("#chk-guest").prop("checked"),s=i[19];return!!(!c||c&&s)}),$.fn.dataTable.ext.search.push(function(e,i,r){for(var c=$("#input-guest-rune").val(),s=[20,21],n=0,t=s.length;n<t;n++)if(i[s[n]].indexOf(c)!==-1)return!0;return!1}),$.fn.dataTable.ext.search.push(function(e,i,r){for(var c=$(".search-box input").val().toLowerCase(),s=[0,1,9,19],n=0,t=s.length;n<t;n++)if(i[s[n]].toLowerCase().indexOf(c)!==-1)return!0;return!1}),$("#chk-show-chef").multiselect({enableFiltering:!0,filterPlaceholder:"查找",includeSelectAllOption:!0,numberDisplayed:1,selectAllText:"选择所有",allSelectedText:"厨师",nonSelectedText:"厨师",nSelectedText:"厨师",maxHeight:200,onChange:function(e,c,n){initShow(s,r,i)}}),i){for(j in r.chefs)r.chefs[j].show&&$("#chk-show-chef").multiselect("select",j);$("#chk-show-origin").prop("checked",!1),$("#chk-show-get").parent(".btn").removeClass("hidden"),$("#chk-show-quality").prop("checked",!0).parent(".btn").removeClass("hidden"),$("#chk-show-remark").prop("checked",!0).parent(".btn").removeClass("hidden"),$("#chk-fixed-header").parent(".btn").removeClass("hidden"),$("#chk-get").prop("checked",!0).parents(".box").removeClass("hidden"),$("#chk-get").click(function(){s.draw()}),$.fn.dataTable.ext.search.push(function(e,i,r){var c=$("#chk-get").prop("checked"),s=i[22];return!(c&&(!c||"true"!=s))})}initShow(s,r,i),$(".loading").hide(),$(".main").removeClass("hidden"),s.draw(),$(".chk-show").click(function(){initShow(s,r,i)}),$("#chk-show-all").click(function(){$(".btn:not(.hidden) .chk-show:checked").length==$(".btn:not(.hidden) .chk-show").length?$(".btn:not(.hidden) .chk-show").prop("checked",!1):$(".btn:not(.hidden) .chk-show").prop("checked",!0),initShow(s,r,i)}),$("#chk-fixed-header").change(function(){$(this).prop("checked")?s.fixedHeader.enable():s.fixedHeader.disable()}),$('.chk-fire input[type="checkbox"]').click(function(){s.draw()}),$(".chk-skill").click(function(){$(this).prop("checked")&&$("#chk-single-skill").prop("checked")&&$(".chk-skill").not(this).prop("checked",!1),s.draw()}),$("#chk-single-skill").change(function(){$(this).prop("checked")&&$(".chk-skill:checked").length>1&&($(".chk-skill").prop("checked",!1),s.draw())}),$("#chk-skill-all").click(function(){$("#chk-single-skill").prop("checked")&&$("#chk-single-skill").bootstrapToggle("off"),$(".chk-skill").prop("checked",!0),s.draw()}),$("#input-price").keyup(function(){s.draw()}),$("#input-guest-rune").keyup(function(){s.draw()}),$("#chk-guest").click(function(){s.draw()}),$(".search-box input").keyup(function(){s.draw()}),$("#pagination-history").pagination({dataSource:r.history,callback:function(e,i){var r=historyTemplate(e);$("#data-history").html(r)},pageSize:5,showPageNumbers:!1,showNavigator:!1,showPrevious:!1,showNext:!1})}function generateData(e,r){var c=new Object;c.chefs=new Array;for(j in e.chefs)c.chefs.push(e.chefs[j]);c.history=e.history;var s=new Array,t=0;for(i in e.recipes)if(e.recipes[i].name){s[t]=new Object,s[t].recipeId=e.recipes[i].recipeId,s[t].name=e.recipes[i].name,s[t].stirfry=e.recipes[i].stirfry||"",s[t].boil=e.recipes[i].boil||"",s[t].cut=e.recipes[i].cut||"",s[t].fry=e.recipes[i].fry||"",s[t].roast=e.recipes[i].roast||"",s[t].steam=e.recipes[i].steam||"",s[t].price=e.recipes[i].price||"",s[t].time={display:0!=e.recipes[i].time?secondsToTime(e.recipes[i].time):"",value:0!=e.recipes[i].time?e.recipes[i].time:""},s[t].total=e.recipes[i].total||"",s[t].origin=e.recipes[i].origin,s[t].unlock=e.recipes[i].unlock,s[t].godRune=e.recipes[i].godRune,s[t].get=!!e.recipes[i].hasOwnProperty("personal"),s[t].quality=e.recipes[i].hasOwnProperty("personal")?e.recipes[i].personal.quality:"",s[t].remark=e.recipes[i].hasOwnProperty("personal")?e.recipes[i].personal.remark:"";var a="";for(j=0;j<e.recipes[i].fire;j++)a+="&#x2605;";s[t].fire={display:a,value:e.recipes[i].fire};var o=0,l=0,p=0;e.recipes[i].price>0&&e.recipes[i].time>0&&(p=3600*e.recipes[i].price/e.recipes[i].time,e.recipes[i].total>0&&(o=e.recipes[i].price*e.recipes[i].total,l=e.recipes[i].time*e.recipes[i].total)),s[t].totalPrice=o?o:"",s[t].totalTime={display:l?secondsToTime(l):"",value:l?l:""},s[t].efficiency=p?parseInt(p):"";var h="",d="",f=0;for(k in e.recipes[i].ingredient)e.recipes[i].ingredient[k].name&&(h+=e.recipes[i].ingredient[k].name+"*"+e.recipes[i].ingredient[k].quantity+" ",d+=e.recipes[i].ingredient[k].name,f+=e.recipes[i].ingredient[k].quantity);s[t].ingredients={display:h,value:d};var u=0;e.recipes[i].time>0&&(u=3600*f/e.recipes[i].time),s[t].ingredientsEff=u?parseInt(u):"";var $="",b="";for(g in e.recipes[i].guests)if(e.recipes[i].guests[g].guest){if(r&&e.recipes[i].hasOwnProperty("personal")&&("优"==e.recipes[i].personal.quality&&"优"==e.recipes[i].guests[g].quality||"特"==e.recipes[i].personal.quality&&"神"!=e.recipes[i].guests[g].quality||"神"==e.recipes[i].personal.quality))continue;$+=e.recipes[i].guests[g].quality+"-"+e.recipes[i].guests[g].guest+"<br>",b+=e.recipes[i].guests[g].guest}s[t].levelGuests={display:$,value:b};var y="";for(m in e.guests)for(n in e.guests[m].gifts)if(e.recipes[i].name==e.guests[m].gifts[n].recipe){y+=e.guests[m].name+"-"+e.guests[m].gifts[n].rune+"<br>";break}s[t].guests=y,s[t].chefs=new Array;for(j in c.chefs){var v=Number.MAX_VALUE;e.recipes[i].stirfry>0&&(v=c.chefs[j].stirfry>0?Math.min(v,c.chefs[j].stirfry/e.recipes[i].stirfry):0),v>=1&&e.recipes[i].boil>0&&(v=c.chefs[j].boil>0?Math.min(v,c.chefs[j].boil/e.recipes[i].boil):0),v>=1&&e.recipes[i].cut>0&&(v=c.chefs[j].cut>0?Math.min(v,c.chefs[j].cut/e.recipes[i].cut):0),v>=1&&e.recipes[i].fry>0&&(v=c.chefs[j].fry>0?Math.min(v,c.chefs[j].fry/e.recipes[i].fry):0),v>=1&&e.recipes[i].roast>0&&(v=c.chefs[j].roast>0?Math.min(v,c.chefs[j].roast/e.recipes[i].roast):0),v>=1&&e.recipes[i].steam>0&&(v=c.chefs[j].steam>0?Math.min(v,c.chefs[j].steam/e.recipes[i].steam):0);var w="-",x=0;if(v!=Number.MAX_VALUE&&v>=1){var I=0;v>=4?(I=.5,w="神"):v>=3?(I=.3,w="特"):v>=2?(I=.1,w="优"):v>=1&&(I=0,w="可");var T=0;if(c.chefs[j].hasOwnProperty("skill"))for(k in c.chefs[j].skill){var O=!1;if(c.chefs[j].skill[k].type.indexOf("水产")>=0)for(m in e.recipes[i].ingredient)for(n in e.ingredients)if(e.recipes[i].ingredient[m].name==e.ingredients[n].name&&8==e.ingredients[n].originId){O=!0;break}if(c.chefs[j].skill[k].type.indexOf("面")>=0)for(m in e.recipes[i].ingredient)for(n in e.ingredients)if(e.recipes[i].ingredient[m].name==e.ingredients[n].name&&1==e.ingredients[n].originId){O=!0;break}if(c.chefs[j].skill[k].type.indexOf("肉")>=0)for(m in e.recipes[i].ingredient)for(n in e.ingredients)if(e.recipes[i].ingredient[m].name==e.ingredients[n].name&&(2==e.ingredients[n].originId||3==e.ingredients[n].originId||4==e.ingredients[n].originId)){O=!0;break}if(c.chefs[j].skill[k].type.indexOf("蔬菜")>=0)for(m in e.recipes[i].ingredient)for(n in e.ingredients)if(e.recipes[i].ingredient[m].name==e.ingredients[n].name&&(5==e.ingredients[n].originId||6==e.ingredients[n].originId||7==e.ingredients[n].originId)){O=!0;break}c.chefs[j].skill[k].type.indexOf("炒")>=0&&e.recipes[i].stirfry>0&&(O=!0),c.chefs[j].skill[k].type.indexOf("煮")>=0&&e.recipes[i].boil>0&&(O=!0),c.chefs[j].skill[k].type.indexOf("炸")>=0&&e.recipes[i].fry>0&&(O=!0),c.chefs[j].skill[k].type.indexOf("切")>=0&&e.recipes[i].cut>0&&(O=!0),c.chefs[j].skill[k].type.indexOf("烤")>=0&&e.recipes[i].roast>0&&(O=!0),c.chefs[j].skill[k].type.indexOf("蒸")>=0&&e.recipes[i].steam>0&&(O=!0),c.chefs[j].skill[k].type.indexOf("金币")>=0&&(O=!0),O&&(T+=c.chefs[j].skill[k].addition)}p>0&&(x=(1+I+T+(r?e.furniture:0))*p)}s[t].chefs.push({chefQlty:w,chefEff:x?parseInt(x):""})}t++}return c.recipes=s,c}function initShow(e,i,r){e.column(0).visible($("#chk-show-id").prop("checked"),!1),e.column(2).visible($("#chk-show-fire").prop("checked"),!1);var c=$("#chk-show-skill").prop("checked");e.column(3).visible(c,!1),e.column(4).visible(c,!1),e.column(5).visible(c,!1),e.column(6).visible(c,!1),e.column(7).visible(c,!1),e.column(8).visible(c,!1),e.column(9).visible($("#chk-show-ingredient").prop("checked"),!1),e.column(10).visible($("#chk-show-price").prop("checked"),!1),e.column(11).visible($("#chk-show-time").prop("checked"),!1),e.column(12).visible($("#chk-show-total").prop("checked"),!1),e.column(13).visible($("#chk-show-total-price").prop("checked"),!1),e.column(14).visible($("#chk-show-total-time").prop("checked"),!1),e.column(15).visible($("#chk-show-efficiency").prop("checked"),!1),e.column(16).visible($("#chk-show-ingredient-efficiency").prop("checked"),!1),e.column(17).visible($("#chk-show-origin").prop("checked"),!1),e.column(18).visible($("#chk-show-unlock").prop("checked"),!1),e.column(19).visible($("#chk-show-guest").prop("checked"),!1),e.column(20).visible($("#chk-show-level-guest").prop("checked"),!1),e.column(21).visible($("#chk-show-god-rune").prop("checked"),!1),r?(e.column(22).visible($("#chk-show-get").prop("checked"),!1),e.column(23).visible($("#chk-show-quality").prop("checked"),!1),e.column(24).visible($("#chk-show-remark").prop("checked"),!1)):(e.column(22).visible(!1,!1),e.column(23).visible(!1,!1),e.column(24).visible(!1,!1));for(j in i.chefs){var s=$("#chk-show-chef").val();e.column(25+2*j).visible(s.indexOf(j)>-1,!1),e.column(26+2*j).visible(s.indexOf(j)>-1,!1)}e.columns.adjust().draw(!1)}function historyTemplate(e){var i="";return $.each(e,function(e,r){i+="<p>"+r+"</p>"}),i}function secondsToTime(e){e=Number(e);var i=Math.floor(e/3600/24),r=Math.floor(e/3600%24),c=Math.floor(e/60%60),s=Math.floor(e%60),n="";return i>0&&(n+=i+"天"),r>0&&(n+=r+"小时"),c>0&&(n+=c+"分"),s>0&&(n+=s+"秒"),n}$(function(){$.ajax({cache:!1,success:function(e){init(e)},url:"data/data.json"})});