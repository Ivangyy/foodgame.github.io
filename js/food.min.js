function init(e){var i=generateData(e);$.fn.dataTable.ext.search.push(function(e,i,c){var r=$("#chk-fire-1").prop("checked"),s=$("#chk-fire-2").prop("checked"),a=$("#chk-fire-3").prop("checked"),t=$("#chk-fire-4").prop("checked"),o=$("#chk-fire-5").prop("checked"),n=parseInt(i[2])||0;return!!(r&&1==n||s&&2==n||a&&3==n||t&&4==n||o&&5==n)}),$.fn.dataTable.ext.search.push(function(e,i,c){return!!($("#chk-skill-stirfry").prop("checked")&&(parseInt(i[3])||0)>0||$("#chk-skill-boil").prop("checked")&&(parseInt(i[4])||0)>0||$("#chk-skill-cut").prop("checked")&&(parseInt(i[5])||0)>0||$("#chk-skill-fry").prop("checked")&&(parseInt(i[6])||0)>0||$("#chk-skill-roast").prop("checked")&&(parseInt(i[7])||0)>0||$("#chk-skill-steam").prop("checked")&&(parseInt(i[8])||0)>0)}),$.fn.dataTable.ext.search.push(function(e,i,c){var r=$("#chk-guest").prop("checked"),s=i[18];return!!(!r||r&&s)}),$.fn.dataTable.ext.search.push(function(e,i,c){var r=$("#chk-get").prop("checked"),s=i[19];return!(r&&(!r||"true"!=s))});var c=[{data:"recipeId"},{data:"name"},{data:{_:"fire.value",display:"fire.display"}},{data:"stirfry"},{data:"boil"},{data:"cut"},{data:"fry"},{data:"roast"},{data:"steam"},{data:{_:"ingredients.value",display:"ingredients.display"}},{data:"price",searchable:!1},{data:{_:"time.value",display:"time.display"},searchable:!1},{data:"total",searchable:!1},{data:"totalPrice",searchable:!1},{data:{_:"totalTime.value",display:"totalTime.display"},searchable:!1},{data:"efficiency",searchable:!1},{data:"origin",searchable:!1},{data:"unlock",searchable:!1},{data:"guests"},{data:"get"},{data:"quality",searchable:!1},{data:"remark",searchable:!1}];for(j in e.personal.chefs)$("#chk-show-chef").append("<option value='"+j+"'>"+e.personal.chefs[j].name+"</option>"),$("#food-table thead tr").append("<th>"+e.personal.chefs[j].name+"</th>").append("<th>效率</th>"),c.push({data:"chefQlty"+j,searchable:!1}),c.push({data:"chefEff"+j,searchable:!1});var r=$("#food-table").DataTable({data:i,columns:c,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个菜谱中过滤)"},pagingType:"numbers",lengthMenu:[[20,50,100,-1],[20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4'i><'col-sm-4'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>"});$(".chk-skill").click(function(){$(this).prop("checked")&&$("#chk-single-skill").prop("checked")&&$(".chk-skill").not(this).prop("checked",!1),r.draw()}),$('.chk-fire input[type="checkbox"]').click(function(){r.draw()}),$("#chk-guest").click(function(){r.draw()}),$("#chk-get").click(function(){r.draw()}),$("#chk-single-skill").change(function(){$(this).prop("checked")&&$(".chk-skill:checked").length>1&&($(".chk-skill").prop("checked",!1),r.draw())}),$("#chk-skill-all").click(function(){$("#chk-single-skill").prop("checked")&&$("#chk-single-skill").bootstrapToggle("off"),$(".chk-skill").prop("checked",!0),r.draw()}),$("#chk-show-all").click(function(){$(".btn:not(.hidden) .chk-show:checked").length==$(".btn:not(.hidden) .chk-show").length?$(".btn:not(.hidden) .chk-show").prop("checked",!1):$(".btn:not(.hidden) .chk-show").prop("checked",!0),initShow(r,e)}),window.location.search.indexOf("666")>0&&($("#chk-personal").parents(".box").removeClass("hidden"),$("#chk-personal").bootstrapToggle({on:"个人版",off:"公共版",onstyle:"default"}),$("#chk-personal").change(function(){if($(this).prop("checked")){$("#chk-show-get").parent(".btn").removeClass("hidden"),$("#chk-show-quality").prop("checked",!0).parent(".btn").removeClass("hidden"),$("#chk-show-remark").parent(".btn").removeClass("hidden");for(j in e.personal.chefs)e.personal.chefs[j].show&&$("#chk-show-chef").multiselect("select",j);$("#chk-show-chef").parent(".chk-show-chef-wrapper").removeClass("hidden"),$("#chk-get").prop("checked",!0).parents(".box").removeClass("hidden")}else $("#chk-show-get").prop("checked",!1).parent(".btn").addClass("hidden"),$("#chk-show-quality").prop("checked",!1).parent(".btn").addClass("hidden"),$("#chk-show-remark").prop("checked",!1).parent(".btn").addClass("hidden"),$("#chk-show-chef").multiselect("deselectAll",!1).parent(".chk-show-chef-wrapper").addClass("hidden"),$("#chk-get").prop("checked",!1).parents(".box").addClass("hidden");initShow(r,e)})),initShow(r,e),$(".chk-show").click(function(){initShow(r,e)}),$("#chk-show-chef").multiselect({enableFiltering:!0,filterPlaceholder:"查找",includeSelectAllOption:!0,numberDisplayed:1,selectAllText:"选择所有",allSelectedText:"厨师",nonSelectedText:"厨师",nSelectedText:"厨师",onChange:function(i,c,s){initShow(r,e)}}),$("body").tooltip({selector:'[data-toggle="tooltip"]'}),$("#food-table").removeClass("hidden")}function generateData(e){var c=new Array;for(i in e.recipes){c[i]=new Object,c[i].recipeId=e.recipes[i].recipeId,c[i].name=e.recipes[i].name,c[i].stirfry=e.recipes[i].stirfry||"",c[i].boil=e.recipes[i].boil||"",c[i].cut=e.recipes[i].cut||"",c[i].fry=e.recipes[i].fry||"",c[i].roast=e.recipes[i].roast||"",c[i].steam=e.recipes[i].steam||"",c[i].price=e.recipes[i].price||"",c[i].time={display:0!=e.recipes[i].time?secondsToTime(e.recipes[i].time):"",value:0!=e.recipes[i].time?e.recipes[i].time:""},c[i].total=e.recipes[i].total||"",c[i].origin=e.recipes[i].origin,c[i].unlock=e.recipes[i].unlock,c[i].get=!!e.recipes[i].hasOwnProperty("personal"),c[i].quality=e.recipes[i].hasOwnProperty("personal")?e.recipes[i].personal.quality:"",c[i].remark=e.recipes[i].hasOwnProperty("personal")?e.recipes[i].personal.remark:"";var r="";for(j=0;j<e.recipes[i].fire;j++)r+="&#x2605;";c[i].fire={display:r,value:e.recipes[i].fire};var s=0,a=0,t=0;e.recipes[i].price>0&&e.recipes[i].time>0&&(t=3600*e.recipes[i].price/e.recipes[i].time,e.recipes[i].total>0&&(s=e.recipes[i].price*e.recipes[i].total,a=e.recipes[i].time*e.recipes[i].total)),c[i].totalPrice=s?s:"",c[i].totalTime={display:a?secondsToTime(a):"",value:a?a:""},c[i].efficiency=t?parseInt(t):"";var o="",l="";for(k in e.recipes[i].ingredient)o+=e.recipes[i].ingredient[k].name+"*"+e.recipes[i].ingredient[k].quantity+" ",l+=e.recipes[i].ingredient[k].name;c[i].ingredients={display:o,value:l};var h="",h="";for(m in e.guests){for(n in e.guests[m].gifts)if(e.recipes[i].name==e.guests[m].gifts[n].recipe){h+=e.guests[m].name+"-"+e.guests[m].gifts[n].rune+"<br>";break}}c[i].guests=h;for(j in e.personal.chefs){var p=Number.MAX_VALUE;e.recipes[i].stirfry>0&&(p=e.personal.chefs[j].stirfry>0?Math.min(p,e.personal.chefs[j].stirfry/e.recipes[i].stirfry):0),p>=1&&e.recipes[i].boil>0&&(p=e.personal.chefs[j].boil>0?Math.min(p,e.personal.chefs[j].boil/e.recipes[i].boil):0),p>=1&&e.recipes[i].cut>0&&(p=e.personal.chefs[j].cut>0?Math.min(p,e.personal.chefs[j].cut/e.recipes[i].cut):0),p>=1&&e.recipes[i].fry>0&&(p=e.personal.chefs[j].fry>0?Math.min(p,e.personal.chefs[j].fry/e.recipes[i].fry):0),p>=1&&e.recipes[i].roast>0&&(p=e.personal.chefs[j].roast>0?Math.min(p,e.personal.chefs[j].roast/e.recipes[i].roast):0),p>=1&&e.recipes[i].steam>0&&(p=e.personal.chefs[j].steam>0?Math.min(p,e.personal.chefs[j].steam/e.recipes[i].steam):0);var d="-",f=0;if(p!=Number.MAX_VALUE&&p>=1){var u=0;p>=4?(u=.5,d="神"):p>=3?(u=.3,d="特"):p>=2?(u=.1,d="优"):p>=1&&(u=0,d="可");var b=0;if(e.personal.chefs[j].hasOwnProperty("skill"))for(k in e.personal.chefs[j].skill)if("水产"==e.personal.chefs[j].skill[k].type){var $=!1;for(m in e.recipes[i].ingredient)for(n in e.ingredients)if(e.recipes[i].ingredient[m].name==e.ingredients[n].name&&8==e.ingredients[n].originId){$=!0;break}$&&(b+=e.personal.chefs[j].skill[k].addition)}else if("炸类"==e.personal.chefs[j].skill[k].type){var $=!1;for(k in e.recipes[i].ingredient)if(e.recipes[i].fry>0){$=!0;break}$&&(b+=e.personal.chefs[j].skill[k].addition)}t>0&&(f=(1+u+b+e.personal.furniture)*t)}c[i]["chefQlty"+j]=d,c[i]["chefEff"+j]=f?parseInt(f):""}}return c}function initShow(e,i){e.column(0).visible($("#chk-show-id").prop("checked"),!1),e.column(2).visible($("#chk-show-fire").prop("checked"),!1);var c=$("#chk-show-skill").prop("checked");e.column(3).visible(c,!1),e.column(4).visible(c,!1),e.column(5).visible(c,!1),e.column(6).visible(c,!1),e.column(7).visible(c,!1),e.column(8).visible(c,!1),e.column(9).visible($("#chk-show-ingredient").prop("checked"),!1),e.column(10).visible($("#chk-show-price").prop("checked"),!1),e.column(11).visible($("#chk-show-time").prop("checked"),!1),e.column(12).visible($("#chk-show-total").prop("checked"),!1),e.column(13).visible($("#chk-show-total-price").prop("checked"),!1),e.column(14).visible($("#chk-show-total-time").prop("checked"),!1),e.column(15).visible($("#chk-show-efficiency").prop("checked"),!1),e.column(16).visible($("#chk-show-origin").prop("checked"),!1),e.column(17).visible($("#chk-show-unlock").prop("checked"),!1),e.column(18).visible($("#chk-show-guest").prop("checked"),!1),e.column(19).visible($("#chk-show-get").prop("checked"),!1),e.column(20).visible($("#chk-show-quality").prop("checked"),!1),e.column(21).visible($("#chk-show-remark").prop("checked"),!1);for(j in i.personal.chefs){var r=$("#chk-show-chef").val();e.column(22+2*j).visible(r.indexOf(j)>-1,!1),e.column(23+2*j).visible(r.indexOf(j)>-1,!1)}e.columns.adjust().draw(!1)}function secondsToTime(e){e=Number(e);var i=Math.floor(e/3600/24),c=Math.floor(e/3600%24),r=Math.floor(e/60%60),s=Math.floor(e%60),a="";return i>0&&(a+=i+"天"),c>0&&(a+=c+"小时"),r>0&&(a+=r+"分"),s>0&&(a+=s+"秒"),a}$(function(){$.ajax({cache:!1,success:function(e){init(e)},url:"data/data.json"})});